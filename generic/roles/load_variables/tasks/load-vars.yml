- name: load variables
  include_vars:
    file: '{{ item }}'
  with_fileglob:
    - '{{ load_vars_root }}/*.yml'
    - '{{ load_vars_root }}/*.json'
    - '{{ load_vars_root }}/*.yaml'
  register: loaded_variables

- name: fail on no variables and strict mode
  fail:
    msg: 'In strict mode, variables files should be matched in the given directory: {{ load_vars_root }}'
  when:
    - load_vars_strict
    - loaded_variables | length == 0
