- name: create service directory
  file:
    name: '{{ service_dir }}'
    state: directory
    owner: '{{ service_user }}'
    group: '{{ service_group }}'
  with_items:
    - '{{ scmd_service_dir }}'
  loop_control:
    loop_var: service_dir

- name: create volumes directory
  file:
    name: '{{ volume_dir }}'
    state: directory
    owner: '{{ service_user }}'
    group: '{{ service_group }}'
  with_items:
    - '{{ scmd_volume_dirs }}'
  loop_control:
    loop_var: volume_dir

- name: create env directory
  file:
    name: '{{ env_dir }}'
    state: directory
    owner: '{{ service_user }}'
    group: '{{ service_group }}'
  with_items:
    - '{{ scmd_full_env_dir }}'
  loop_control:
    loop_var: env_dir
  when:
    - not scmd_no_env
    - scmd_env_files is defined
    - scmd_env_files | length > 0

- name: copy env files
  template:
    src: '{{ env_file.path }}'
    dest: "{{ scmd_full_env_dir }}/{% if env_file.name != 'env' %}{{ env_file.name }}{% endif %}.env"
  with_items: '{{ scmd_env_files }}'
  loop_control:
    loop_var: env_file
  when:
    - not scmd_no_env
    - scmd_env_files is defined
    - scmd_env_files | length > 0
